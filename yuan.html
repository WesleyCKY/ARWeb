<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- auto refresh, for dev purpose -->
    <!-- <meta http-equiv="refresh" content="10"> -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- import model-viewer into this file -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <script type="module">
        const modelViewer = document.querySelector("model-viewer");
        //switchSrc function  
        window.switchSrc = (element, name, backDrop) => {
          const base = "assets/";
          modelViewer.src = base + "glb/"+ name +".glb";
          modelViewer.poster = base + "png/"+ name +".png";
          const slides = document.querySelectorAll(".slide");
          slides.forEach((element) => {element.classList.remove("selected");});

          // dynamic background image, fetch from map folder
          let backgroundImg ="url(" + base + "png/map/"+ backDrop +"/"+ backDrop+ "/"+ backDrop +"_02.png)";
          // console.log(backgroundImg);
          document.getElementById('mv').style.backgroundImage=backgroundImg;

          var textTemp = '';
           // fetch .txt file to the id="detail" div 
          fetch(base+ "txt/" + name + ".txt")
            .then(response => response.text())
          // .then(text => document.getElementById("detail").innerHTML = text) 
            .then((text) => {
              var i;
              var NumOfChinese = 0;
              var lastChar = 0;
              // console.log("Text length", text.length);

              //get where is the end of chinese word
              for (i = 0; i < text.length-1; i++) { 
                if (text[i].match("[\u4E00-\u9FA5]+")) {
                  NumOfChinese += 1;
                }
              }
              // console.log("Num of Chinese Char: ",NumOfChinese);

              // loop through all the words and remove all the space
              for (var j = 0; j < text.length; j++) {
                  // In range of Chinese words
                  if (j < NumOfChinese && text[j].match(' '||'/s'||'/S')) {
                      console.log("eliminated word:",text[j]);
                      // textTemp += 'X';
                      console.log(j);
                      continue;
                  }
                  
                  // console.log("Eng zone");
                  textTemp += text[j];
              }
              // console.log(textTemp);
              document.getElementById("detail").innerHTML = textTemp;
            })
            
          element.classList.add("selected");
        };
      
        document.querySelector(".slider").addEventListener('beforexrselect', (ev) => {
          // Keep slider interactions from affecting the XR scene.
          ev.preventDefault();
        });
      </script>
    <title>元朝</title>
<link rel="stylesheet" href="./style.css">
</head>
<!-- Model viwer template -->
<body>
  <!-- init model, change while switchSrc() is called -->
    <model-viewer id="mv" src="assets/glb/liufutong.glb" 
        ar ar-modes="webxr scene-viewer quick-look"
        pan-y pan-x
        Max-field-of-view="50deg"
        Min-field-of-view="50deg"
        camera-orbit="180deg 1.5m"
        camera-controls="" background-color="#455A64" alt="A 3D model carousel">
        <div id="detail" style="height:69vh;
                    width:23vw;
                    overflow:auto;
                    float: right;
                    font-size: 20px;
                    font-size: 2.3vw;
                    background-color:rgb(61, 63, 58);opacity:0.7;
                    color:white;
                    scrollbar-base-color:gold;
                    font-family:serif;
                    padding:40px 40px;">
                   劉福通（1321-1366）漢族，元末民變領袖。劉福通雖家境富裕，但爲人正直仗義且見識過人，因此眼見腐敗的朝廷，便決定與韓山童籌備起義之事。其後，韓山童在盟誓期間被捕，劉福通倖幸逃脫，同年捲土重來，再次在潁州起義，在民眾響應下，成功起義，並扶持韓山童之子韓林兒建立大宋政權，國號大宋（韓宋）。後來北上時因戰術失誤，導致被元軍圍困，幸好得以逃脫，南奔安豐。不久後，劉福通再次北上，擊敗元軍。隨後北伐分三路大軍，因三路互相難以支援，相繼失利。 最終劉福通被敵人襲擊，在安豐犧牲。 LIU Fu-tong (1321 to 1366 CE,) was a leader of peasant rebellions in the late Yuan Dynasty. As the government was corrupt, he decided to prepare for the uprising with HAN Shan-tong . With the support from the public, he helped HAN Lin’er, the son of Han Shan-tong, establish the Great Dynasty or Han Song. At a later war, due to tactical mistakes, he was besieged by the Yuan’s army. After getting through the difficult situation, he went north again and defeated the Yuan’s army. However, he was under attack and died in Anfung eventually.
        </div>
  <button slot="ar-button" id="ar-button">
    View in AR mode
  </button>
  <!-- Sliding button list -->
  <div class="slider">
    <div class="slides">
     
      <button class="slide" onclick="switchSrc(this, 'liufutong', 'yuan')" style="background-image: url('assets/png/liufutong.png');">
        <svg viewBox="0 0 450 50">
          <text y="50">25.劉福通</text>
        </svg>
      </button>
      <button class="slide" onclick="switchSrc(this, 'hubilie', 'yuan')" style="background-image: url('assets/png/hubilie.png');">
        <svg viewBox="0 0 450 50">
          <text y="50">26.忽必烈</text>
        </svg>
      </button>
      <button class="slide" onclick="switchSrc(this, 'tiemuzhen', 'yuan')" style="background-image: url('assets/png/tiemuzhen.png');">
        <svg viewBox="0 0 450 50">
          <text y="50">27.鐵木真</text>
        </svg>
      </button>
      <button class="slide" onclick="switchSrc(this, 'hanshantong', 'yuan')" style="background-image: url('assets/png/hanshantong.png');">
        <svg viewBox="0 0 450 50">
          <text y="50">28.韓山童</text>
        </svg>
      </button>
    </div>
  </div>
</model-viewer>
</body>
</html>